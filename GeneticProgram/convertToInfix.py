from ExpressionGenerator import GenMember


class ToInfixParser:
    """
    Class to convert the prefix expression to infix notation.
    """

    def __init__(self):
        self.stack = []

    @staticmethod
    def deconstruct_tree(list_nodes):
        """

        :param list_nodes: list of nodes belonging to tree
        :return: the values of the tree in prefix notation.
        """
        pref = list()
        for i in list_nodes:
            pref.append(str(i.value))
        return pref

    def get_infix_notation(self, prefix_expr):
        """
        Function to convert the prefix expression back to infix notation.
        :param prefix_expr: prefix expression to be converted.
        :return: infix expression.
        """
        for e in prefix_expr[::-1]:
            if e not in GenMember.operations:
                self.stack.append(e)

            else:
                operand1 = self.stack.pop(-1)
                operand2 = self.stack.pop(-1)
                op = e
                self.stack.append("({}{}{})".format(operand1, op, operand2))

        return self.stack.pop()[1:-1]


class Calculator:
    def __init__ (self):
        self.stack = []

    def push (self, p):
        if p in ['+', '-', '*', '/']:
            op1 = self.stack.pop ()
            op2 = self.stack.pop ()
            self.stack.append ('(%s %s %s)' % (op1, p, op2) )
        elif p == '!':
            op = self.stack.pop ()
            self.stack.append ('%s!' % (op) )
        elif p in ['sin', 'cos', 'tan']:
            op = self.stack.pop ()
            self.stack.append ('%s(%s)' % (p, op) )
        else:
            self.stack.append (p)

    def convert (self, l):
        l.reverse ()
        for e in l:
            self.push (e)
        return self.stack.pop ()



# if __name__=="__main__":
    # l = ['-', '-', 'X1', 'X2', 'X5', '-', 'X4'] #, '-', '/', '-', 'X2', 'X1', 'X2', 'X4', '-', 'X2', '-', 'X4', '-', 'X2', 'X2', '-', '/', '-', 'X5', '15.920226976401475', 'X4', 'X2', '-', 'X2', '+', '/', 'X2', 'X3', 'X1', '-', 'X3', '*', 'X2', '+', 'X1', 'X1', '-', 'X5', 'X2', '/', '/', 'X4', 'X4', '/', '-', '*', 'X5', 'X1', '48.993362991231834', 'X3', '-', 'X4', '-', 'X3', '/', 'X5', 'X1', '+', '/', '*', 'X5', 'X1', '48.993362991231834', 'X5', '-', '/', '*', 'X5', 'X1', '48.993362991231834', 'X4', '-', '/', 'X1', '*', '-41.74598353233898', 'X4', 'X5', '/', 'X2', '-', 'X1', '-', 'X2', 'X5', '+', 'X2', '*', 'X4', '*', 'X5', 'X2', '-', '*', '*', 'X3', 'X1', '48.993362991231834', 'X2', '+', '*', 'X5', 'X3', '-', 'X2', 'X2', '-', 'X5', 'X5', '-', '/', '8.603961822176931', 'X4', '-', '42.701588481847196', '-', 'X5', '*', 'X4', 'X5', '-', '*', '-', 'X4', '15.920226976401475', 'X3', 'X5', '-', 'X2', '*', 'X5', '/', 'X5', 'X3', '-', '/', '*', 'X5', '-', 'X5', 'X2', '48.993362991231834', 'X2', '-', 'X1', '+', 'X3', 'X3', '*', '*', '-', 'X5', '15.920226976401475', 'X3', 'X5', '/', 'X5', '-', 'X4', '/', 'X3', 'X3', '+', '*', 'X4', 'X5', 'X2', '-', 'X5', '/', 'X3', '/', '*', 'X5', 'X2', '48.993362991231834', '+', 'X2', '-', 'X3', '*', 'X4', 'X5', '-', 'X3', '-', 'X5', '/', 'X4', 'X3', '-', 'X4', '-', '/', 'X5', 'X3', 'X2', '-', '-', 'X5', 'X1', '+', 'X4', 'X3', '-', '-', 'X5', 'X3', '+', 'X4', 'X3', '-', '/', '*', 'X5', 'X1', '-31.405099898299696', 'X2', '-', '-', 'X5', 'X3', '+', 'X4', 'X3', '+', 'X4', '-', 'X5', '/', 'X4', 'X2', '-', 'X5', '-', 'X4', '+', 'X3', 'X5', '-', 'X3', '/', '43.22109817843986', '/', '8.063644603249726', 'X3', '-', '/', '8.603961822176931', 'X4', '-', '42.701588481847196', '*', 'X5', '+', 'X4', 'X5', '-', 'X5', '+', 'X3', '*', 'X4', 'X3', '-', 'X5', '-', 'X4', '/', 'X3', '36.993027218931864', '-', '-', 'X5', 'X5', '+', 'X4', 'X3', '*', '*', '-', 'X5', '15.920226976401475', 'X3', '/', 'X4', 'X3', '+', 'X2', '-', 'X5', 'X3', '-', '-', 'X5', 'X4', '+', 'X4', 'X3', '+', 'X4', '*', 'X5', '/', 'X3', 'X3', '-', 'X5', '-', 'X4', '-', 'X5', 'X2', '-', '/', 'X3', '36.993027218931864', '+', 'X5', 'X3', '+', 'X3', '-', 'X5', '/', 'X1', 'X3', '-', '/', '8.603961822176931', 'X4', '-', '42.701588481847196', '-', 'X5', '*', 'X4', 'X4', '-', '+', '*', 'X5', 'X1', '-', 'X5', 'X2', 'X2', '-', '48.993362991231834', '+', 'X5', 'X3', '-', 'X4', '-', 'X3', '*', 'X4', 'X5', '+', 'X4', '-', 'X5', '/', 'X4', 'X3', '-', 'X5', '-', 'X3', '*', 'X4', 'X5', '*', '-', 'X3', 'X2', '*', 'X3', 'X1', '-', '/', '*', 'X3', 'X4', '48.993362991231834', 'X2', '+', 'X4', '-', 'X4', '/', 'X5', 'X3', '-', '/', '8.603961822176931', 'X4', '+', '42.701588481847196', '-', 'X5', '*', 'X4', 'X5', '-', 'X3', '-', 'X4', '*', 'X2', 'X2', '-', '/', '*', 'X5', 'X1', '48.993362991231834', 'X2', '-', 'X5', '-', 'X4', '-', 'X3', 'X3', '+', 'X3', '-', 'X5', '/', 'X4', 'X3', '-', '/', '*', 'X4', 'X1', '48.993362991231834', 'X2', '-', '-', 'X5', 'X3', '+', 'X4', 'X3', '-', 'X4', '-', 'X4', '+', 'X3', 'X3', '-', '/', '*', 'X5', 'X1', '48.993362991231834', 'X2', '-', 'X3', '+', 'X2', '+', 'X5', 'X3', '-', '/', '8.603961822176931', 'X4', '-', '42.701588481847196', '-', 'X4', '*', 'X2', 'X2', '-', 'X5', '+', 'X5', '*', 'X4', 'X3', '-', '/', 'X5', 'X3', 'X3', '-', 'X5', '-', 'X4', '+', 'X3', '*', '16.904358049917068', 'X3', '-', 'X5', '-', 'X4', 'X4', '-', 'X3', '-', 'X2', '+', '+', 'X3', 'X3', 'X5', '-', 'X5', '-', 'X4', '/', 'X3', '36.993027218931864', '-', 'X5', '-', 'X4', '+', 'X3', 'X3', '-', '-', 'X5', 'X3', '+', 'X4', '+', 'X4', 'X3', '-', '-', 'X5', 'X2', 'X5', '-', 'X5', '-', 'X4', '/', 'X3', '36.993027218931864', '*', 'X1', '-', 'X4', '*', 'X4', 'X2', '-', 'X1', '-', 'X4', '*', 'X2', 'X2', '+', 'X4', '-', 'X2', '/', 'X4', 'X3', '-', '/', '*', 'X5', 'X1', '48.993362991231834', 'X2', '-', '-', 'X5', 'X2', 'X4', '-', 'X4', 'X2', '-', 'X5', '-', '/', '*', 'X4', 'X5', '48.993362991231834', '*', 'X2', 'X2', '-', '/', '8.603961822176931', 'X4', '-', '42.701588481847196', 'X5', '-', 'X1', '-', 'X2', '+', 'X4', 'X5', '+', '/', 'X5', '48.993362991231834', 'X2', '-', '-', '*', 'X5', 'X5', 'X2', 'X5', '-', 'X3', '-', 'X4', '*', 'X2', 'X1', '-', '/', '*', 'X3', 'X2', '48.993362991231834', 'X2', '-', '/', '*', 'X5', 'X1', '/', '*', 'X4', 'X1', '48.993362991231834', 'X2', '-', '48.993362991231834', 'X5', '-', '*', '-', 'X5', '15.920226976401475', 'X3', 'X2', '-', '/', '*', 'X3', 'X2', '48.993362991231834', 'X4', '-', '/', '*', 'X4', 'X1', '48.993362991231834', 'X2', '+', 'X4', '/', 'X5', '/', 'X4', 'X3', '-', '-', 'X4', '*', 'X2', 'X2', '-', 'X4', '+', 'X3', 'X3', '-', 'X1', 'X5', '-', '/', '*', 'X3', 'X2', '48.993362991231834', 'X2', '-', 'X1', '*', 'X5', '/', 'X5', 'X1', '-', '-', 'X5', 'X4', 'X4', '/', 'X5', '-', 'X2', '*', 'X2', 'X5', '-', '/', 'X5', '*', '16.904358049917068', 'X1', 'X3', '-', '-', '*', 'X5', 'X1', '172.77367441618287', 'X2', '-', 'X5', '-', 'X4', '-', 'X5', '/', 'X4', 'X3', '+', 'X3', '/', 'X3', '36.993027218931864', '-', '*', '-', '/', 'X4', 'X3', '15.920226976401475', 'X3', 'X2', '+', 'X3', '-', 'X5', 'X3', '+', 'X4', '-', 'X4', '/', 'X4', 'X3', '-', '/', '8.603961822176931', 'X4', '-', '42.701588481847196', '-', 'X5', '*', 'X4', 'X4', '-', '-', 'X5', 'X4', '+', 'X4', 'X3', '-', '/', '8.603961822176931', 'X2', '*', '42.701588481847196', '-', 'X5', '*', 'X4', 'X4', '-', '-', 'X4', 'X2', 'X5', '-', '/', '*', 'X4', 'X1', '48.993362991231834', 'X2', '-', '/', '*', 'X5', 'X1', '48.993362991231834', 'X2', '-', '-', 'X5', 'X2', 'X4', '-', '-', 'X5', 'X2', 'X5', '-', '/', '*', 'X4', 'X1', '88.5793402164124', 'X2', '-', '-', 'X5', 'X3', '+', 'X4', 'X3', '+', 'X4', '-', 'X5', '-', 'X4', 'X3', '-', 'X3', '-', 'X5', '/', 'X4', 'X3', '-', '-', 'X5', 'X3', 'X4', '-', '/', '*', 'X4', 'X1', '48.993362991231834', 'X2', '-', '-', 'X5', 'X2', 'X4', '-', '/', '*', 'X3', 'X2', '180.07237747284952', 'X2', '-', 'X5', '-', 'X4', '/', 'X5', '36.993027218931864', '-', '/', '*', 'X4', '/', 'X3', '36.993027218931864', '88.5793402164124', 'X2', '-', 'X5', '-', 'X4', 'X2', '-', '/', '*', 'X5', 'X1', '48.993362991231834', 'X2', '-', '+', '*', 'X4', 'X1', '48.993362991231834', 'X2', '-', '-', 'X5', 'X2', 'X2', '-', '/', '*', 'X5', 'X1', '48.993362991231834', 'X5', '-', '-', 'X5', 'X2', 'X4', '-', '-', 'X5', 'X2', 'X2', '-', 'X5', '-', 'X4', '+', 'X3', 'X3', '-', '-', 'X5', 'X2', '+', 'X4', 'X3', '-', '-', '-', 'X5', '15.920226976401475', 'X3', 'X2', '-', 'X5', '-', 'X4', '+', 'X3', 'X3', '-', 'X5', '-', 'X4', '-', 'X5', 'X2', '-', '/', 'X4', '36.993027218931864', 'X4', '-', 'X3', 'X2', '-', 'X5', '-', '/', '*', 'X4', 'X1', '48.993362991231834', '*', 'X4', 'X4', '-', 'X5', '-', 'X3', '*', 'X4', 'X5', '-', '-', 'X5', 'X2', 'X4', '-', '-', 'X5', 'X3', '+', 'X4', '/', '*', 'X3', 'X2', '48.993362991231834', '-', 'X3', 'X2', '-', '-', 'X5', 'X2', 'X5', '-', '-', 'X5', 'X2', '+', 'X4', 'X4', '-', '-', 'X5', 'X2', 'X4', '-', '-', 'X5', 'X2', '+', 'X2', 'X4', '-', '-', 'X5', 'X2', '+', 'X4', 'X3', '*', '/', '*', 'X3', 'X5', '122.36160034027947', 'X2', '-', '-', 'X5', 'X2', '+', 'X4', 'X3', '-', '*', 'X2', 'X2', 'X4', '-', 'X2', '+', 'X4', 'X4', '-', 'X5', '-', 'X3', '*', 'X4', '-', 'X5', 'X2', '-', 'X2', 'X4', '-', '-', 'X5', '-', 'X5', 'X2', '+', 'X2', 'X4', '-', '-', 'X5', 'X2', '+', 'X2', 'X4', '-', 'X1', '-', 'X4', '*', 'X3', 'X3', '-', '-', 'X5', 'X3', '+', 'X4', 'X3', '-', '+', '*', 'X5', 'X1', '48.993362991231834', 'X2', '-', '-', 'X1', 'X2', '*', 'X2', 'X2', '-', '/', 'X5', '244.9477390735756', 'X2', '-', 'X5', '-', '+', 'X4', 'X3', '*', 'X4', 'X5', '-', '-', 'X5', 'X5', 'X3', '-', 'X5', '-', 'X4', '+', 'X3', 'X3', '-', '-', 'X5', 'X2', '/', 'X2', 'X4', '-', '/', '*', 'X2', 'X1', '48.993362991231834', 'X2', '-', '-', 'X5', 'X4', '+', 'X5', 'X4', '-', 'X3', 'X2', '+', '/', '*', 'X4', 'X1', '88.5793402164124', '-', 'X5', '/', 'X4', 'X5', '-', '-', 'X5', 'X2', 'X5', '-', '-', 'X5', 'X2', 'X4', '-', '-', 'X5', 'X2', '+', 'X2', 'X4', '-', '-', '*', 'X4', 'X1', '88.5793402164124', 'X2', '-', '-', 'X5', 'X3', '+', 'X2', 'X3', '-', '/', '*', 'X3', 'X5', '48.993362991231834', 'X2', '-', 'X5', '-', 'X3', '*', 'X4', 'X5', '-', '-', 'X1', 'X2', 'X4', '-', '-', 'X5', 'X2', '+', 'X2', 'X4', '-', '-', 'X5', 'X2', '+', 'X4', 'X3', '-', '-', 'X5', 'X2', 'X3', '-', '-', 'X3', 'X4', '+', 'X4', 'X3', '-', 'X5', '-', 'X3', '*', 'X4', 'X5', '-', '-', 'X5', 'X3', '+', 'X3', 'X3', '-', '-', 'X5', 'X2', '+', 'X2', 'X3', '-', '-', 'X5', 'X1', '+', 'X4', 'X4', '-', 'X5', '-', 'X3', '*', 'X4', 'X5', '-', '-', 'X5', 'X2', 'X4', '-', '-', 'X5', 'X2', '+', 'X2', 'X4', '-', '/', '*', 'X3', 'X2', '-99.0583045647505', 'X2', '-', '-', 'X5', 'X2', 'X4', '-', '-', 'X4', 'X2', 'X4', '-', '/', '8.603961822176931', 'X4', '-', '42.701588481847196', 'X5', '-', '-', 'X5', 'X2', '+', 'X4', 'X3', '-', '/', '*', 'X5', 'X1', '48.993362991231834', 'X2', '/', '*', 'X3', 'X4', '-', '-', '/', '-', 'X5', 'X2', '48.993362991231834', 'X2']
    # l = ['+', '+', 'X5', 'X1', '-', 'X3', 'X2', '/', '1.5569188021980096', '*', 'X2', '*', 'X2', '31.329074404197982', '/', '*', 'X1', 'X5', '-', 'X4', '24.514389443359814', '-', 'X5', '*', 'X5', '-', 'X2', 'X2', '-', 'X5', '*', 'X5', '4.954989333488108', '-', '/', 'X5', '*', 'X2', '24.514389443359814', '-', 'X2', 'X5', '*', '/', 'X5', '4.954989333488108', '-', 'X1', 'X2', '-', '/', 'X5', 'X3', '-', 'X3', 'X2', '-', 'X1', '-', 'X3', '/', 'X5', 'X5', '-', 'X2', '*', 'X2', '*', 'X2', 'X3', '/', '-', 'X2', 'X4', 'X4', '-', '-', 'X3', '/', 'X1', 'X1', '-', 'X3', 'X3', '-', 'X5', '-', '*', 'X5', 'X5', 'X4', '-', 'X5', '/', 'X1', '*', '47.64460559081151', 'X5', '-', '/', 'X5', '4.954989333488108', '-', 'X2', '17.619642363400896', '-', '/', 'X5', 'X3', '+', '22.701507162911017', 'X2', '-', '/', 'X4', '-82.91399102794578', '*', 'X5', 'X2', '-', '*', 'X1', 'X3', '-', 'X3', 'X2', '-', '/', 'X5', '17.619642363400896', '*', '22.701507162911017', 'X2', '-', '/', 'X4', '52.720962992350024', '*', 'X5', 'X2', '-', '/', 'X5', '23.74354176421265', '-', 'X3', 'X1', '-', 'X5', '-', 'X1', '-', 'X1', 'X3', '-', 'X1', '-', 'X3', '/', 'X5', 'X3', '-', 'X5', '/', '49.83773416313253', '-', 'X2', 'X5', '-', '1.5569188021980096', 'X3', '-', 'X1', '-', '*', 'X3', '+', 'X5', '31.329074404197982', '/', 'X2', 'X3', '+', 'X5', '*', '*', 'X2', 'X1', 'X4', '-', '7.017843318138278', '*', 'X3', '+', 'X5', '31.329074404197982', '-', 'X5', '/', '13.275456770622355', '+', '-', '/', 'X2', 'X3', 'X1', 'X4', '-', 'X4', 'X2', '-', 'X5', '-', '*', 'X5', 'X3', 'X4', '-', '1.5569188021980096', '*', 'X3', '+', 'X5', '402.3283226997252', '-', 'X5', '-', 'X1', '/', '47.64460559081151', 'X5', '-', 'X3', '*', 'X2', '*', 'X2', '24.514389443359814', '-', '/', 'X5', '4.954989333488108', '-', 'X2', 'X3', '-', 'X1', '/', 'X5', '*', 'X4', 'X3', '+', '-', 'X1', '*', '47.64460559081151', 'X2', '-', '*', 'X4', 'X1', 'X4', '-', 'X5', 'X2', '+', 'X5', '*', 'X1', '*', 'X5', '146.3162473019197', '-', '3.758405028415961', '-', '*', 'X4', 'X1', 'X4', '+', 'X5', '-', '*', 'X4', 'X1', 'X4', '-', 'X2', '*', 'X5', '+', 'X2', '24.514389443359814', '-', 'X5', '-', '*', 'X5', 'X3', 'X4', '-', '/', 'X5', '1.8799243278951607', '*', 'X5', 'X2', '-', '+', 'X5', '4.954989333488108', '-', 'X2', 'X3', '-', '/', 'X5', '17.619642363400896', '*', '22.701507162911017', 'X2', '-', '/', 'X5', '/', '26.99236789924935', '41.98750715288318', '-', 'X2', 'X3', '-', '/', 'X3', '4.954989333488108', 'X3', '-', '/', 'X4', '40.06250334103592', '/', 'X5', '4.954989333488108', '-', '*', 'X5', 'X2', '-', 'X4', 'X3', '-', 'X1', '/', 'X5', '*', 'X4', 'X3', '-', '*', 'X2', 'X4', '+', 'X1', 'X5', '-', 'X5', '-', '*', 'X5', 'X3', 'X4', '-', '*', 'X4', '119.68240286819237', '*', 'X5', 'X2', '-', '/', 'X5', '52.720962992350024', '*', 'X5', 'X2', '-', 'X5', '-', 'X3', '*', '47.64460559081151', 'X2', '+', 'X5', '-', 'X4', 'X4', '-', 'X5', '+', '*', 'X5', 'X3', '*', 'X4', 'X1', '-', '/', 'X4', '52.720962992350024', '*', 'X5', '*', 'X3', '+', 'X5', '31.329074404197982', '-', '1.5569188021980096', 'X5', '-', '/', 'X5', '52.720962992350024', '*', 'X5', 'X2', '-', '1.5569188021980096', '*', 'X3', '-', 'X1', '146.3162473019197', '-', 'X1', '*', 'X5', '*', 'X2', '24.514389443359814', '-', 'X2', '/', 'X2', '/', 'X2', 'X3', '-', '1.5569188021980096', '*', 'X3', '+', 'X1', '146.3162473019197', '-', '/', 'X5', '4.954989333488108', '/', 'X2', 'X3', '-', '/', 'X5', 'X4', '-', 'X3', 'X4', '-', '/', 'X2', '52.720962992350024', '*', 'X5', 'X2', '-', '/', 'X4', '40.06250334103592', '*', 'X5', '*', 'X5', 'X2', '-', '/', 'X4', '52.720962992350024', 'X2', '-', 'X5', '-', '*', 'X5', 'X3', 'X4', '-', 'X4', '-', 'X4', '*', 'X1', 'X3', '-', '1.5569188021980096', '*', 'X3', '+', 'X5', '31.329074404197982', '-', '/', 'X5', '4.954989333488108', '*', 'X2', 'X3', '-', 'X5', 'X1', '-', 'X5', '-', 'X4', '-', '-', 'X1', '*', '173.83300373583427', 'X2', 'X3', '-', '*', 'X4', '/', 'X5', '4.954989333488108', 'X2', '-', '261.90108737880604', '-', 'X2', 'X3', '-', '/', 'X5', '17.619642363400896', '*', '22.701507162911017', 'X2', '-', '/', 'X5', '-89.59458401700087', '*', 'X5', 'X2', '-', '/', 'X5', '17.619642363400896', '*', '77.36361936092736', 'X2', '/', '/', 'X5', 'X4', '/', 'X3', 'X4', '-', 'X1', '*', 'X5', '*', 'X2', '24.514389443359814', '-', '/', 'X5', '17.619642363400896', '*', '22.701507162911017', 'X2', '-', 'X1', '-', 'X3', '/', 'X5', 'X3', '-', '1.5569188021980096', '*', 'X5', '+', 'X5', '146.3162473019197', '-', 'X2', '-', 'X4', 'X1', '-', '1.5569188021980096', '*', 'X3', '+', '+', 'X4', 'X5', '262.44179950343687', '-', '/', 'X5', '4.954989333488108', '-', 'X2', 'X3', '-', '/', 'X5', '17.619642363400896', '/', '22.701507162911017', 'X2', '-', '/', 'X5', '17.619642363400896', '*', '22.701507162911017', 'X2', '-', '/', 'X4', '40.06250334103592', '*', 'X5', 'X2', '+', 'X5', '-', '*', 'X4', 'X1', 'X4', '-', '/', 'X5', 'X4', '-', 'X1', 'X4', '-', '/', 'X5', '19.944206087770773', 'X1', '-', '-', 'X2', 'X5', '*', 'X5', '*', 'X2', '24.514389443359814', '-', 'X5', '-', '*', 'X5', 'X3', 'X4', '-', 'X5', '-', 'X1', '*', '47.64460559081151', 'X2', '-', 'X5', '-', 'X4', '-', '-', 'X1', '*', '173.83300373583427', 'X2', 'X3', '-', '-', 'X2', 'X5', '*', 'X5', '-', 'X2', '24.514389443359814', '-', 'X4', '-', 'X2', 'X3', '-', '/', 'X5', 'X4', '-', 'X3', '/', 'X5', '-1.6648126015314464', '-', 'X1', '*', 'X5', '*', 'X2', '24.514389443359814', '-', '-', 'X4', '40.06250334103592', '*', 'X5', 'X2', '-', 'X2', '*', 'X5', '*', 'X2', '24.514389443359814', '-', '/', 'X5', '4.954989333488108', '-', 'X4', 'X3', '-', '/', 'X4', '40.06250334103592', '*', 'X5', 'X2']
    # t = Calculator()
    # x = t.convert(l)